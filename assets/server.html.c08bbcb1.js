import{_ as o}from"./plugin-vue_export-helper.21dcd24c.js";import{r as l,o as r,c as i,a as e,b as n,F as s,e as d,d as t}from"./app.12aa930c.js";const c={},u=d('<h2 id="environment-variables" tabindex="-1"><a class="header-anchor" href="#environment-variables" aria-hidden="true">#</a> Environment Variables</h2><p>You can configure the Waline server through the following environment variables.</p><div class="custom-container warning"><p class="custom-container-title">Note</p><p>You MUST <strong>redeploy</strong> after updating Environment variables to take effect.</p><p>Vercel needs to be set in <code>Settings</code> - <code>Environment Variables</code>.</p></div><h3 id="basic" tabindex="-1"><a class="header-anchor" href="#basic" aria-hidden="true">#</a> Basic</h3>',4),h=e("thead",null,[e("tr",null,[e("th",null,"Environment Variables"),e("th",null,"Required"),e("th",null,"Description")])],-1),m=e("tr",null,[e("td",null,[e("code",null,"LEAN_ID")]),e("td",null,"\u2705"),e("td",null,"LeanCloud Application ID")],-1),p=e("tr",null,[e("td",null,[e("code",null,"LEAN_KEY")]),e("td",null,"\u2705"),e("td",null,"LeanCloud Application Key")],-1),b=e("tr",null,[e("td",null,[e("code",null,"LEAN_MASTER_KEY")]),e("td",null,"\u2705"),e("td",null,"LeanCloud Application Master Key")],-1),v=e("tr",null,[e("td",null,[e("code",null,"LEAN_SERVER")]),e("td",null,"\u26A0"),e("td",null,"LeanCloud server address if you're leancloud china user")],-1),_=e("tr",null,[e("td",null,[e("code",null,"SITE_NAME")]),e("td"),e("td",null,"site name")],-1),f=e("tr",null,[e("td",null,[e("code",null,"SITE_URL")]),e("td"),e("td",null,"site url")],-1),g=e("tr",null,[e("td",null,[e("code",null,"SECURE_DOMAINS")]),e("td"),e("td",null,"Secure Domains config. Supports multiple domain with Comma separated")],-1),y=e("tr",null,[e("td",null,[e("code",null,"DISABLE_USERAGENT")]),e("td"),e("td",null,[t("wether hide the user agent of commentor. Default value is "),e("code",null,"false")])],-1),w=e("tr",null,[e("td",null,[e("code",null,"DISABLE_REGION")]),e("td"),e("td",null,[t("wether hide commentor's region. Default value is "),e("code",null,"false")])],-1),x=e("tr",null,[e("td",null,[e("code",null,"DISABLE_AUTHOR_NOTIFY")]),e("td"),e("td",null,"wether disable author notification")],-1),E=e("tr",null,[e("td",null,[e("code",null,"AKISMET_KEY")]),e("td"),e("td",null,[t("Akismet antispam service key, default is open, set "),e("code",null,"false"),t(" if you wanna close it.")])],-1),S=e("tr",null,[e("td",null,[e("code",null,"COMMENT_AUDIT")]),e("td"),e("td",null,"Comment audit switcher. We recommend to tip on the placeholder text if it's true.")],-1),T=e("tr",null,[e("td",null,[e("code",null,"LOGIN")]),e("td"),e("td",null,[t("User need login before comment when "),e("code",null,"LOGIN=force")])],-1),L=e("tr",null,[e("td",null,[e("code",null,"AVATAR_PROXY")]),e("td"),e("td",null,[t("Avatar proxy service url, default is "),e("code",null,"https://avatar.75cdn.workers.dev"),t(". You can set "),e("code",null,"false"),t(" to close it")])],-1),A=e("tr",null,[e("td",null,[e("code",null,"GRAVATAR_STR")]),e("td"),e("td",null,[t("Gravatar render string\uFF0Cdefault is "),e("span",null,[e("code",{"v-pre":""},"https://seccdn.libravatar.org/avatar/{{mail|md5}}")]),t("\uFF0Cbase on nunjucks template")])],-1),M=e("td",null,[e("code",null,"OAUTH_URL")],-1),D=e("td",null,null,-1),I=t("OAuth Social Login Service URL\uFF0Cdefault is "),j=e("code",null,"https://user.75.team",-1),O=t(". Also you can custom build with "),R={href:"https://github.com/walinejs/auth",target:"_blank",rel:"noopener noreferrer"},W=t("auth"),k=t("."),N=e("tr",null,[e("td",null,[e("code",null,"WEBHOOK")]),e("td"),e("td",null,"You can set a Webhook URL that will be triggered when you have new comment.")],-1),P=e("tr",null,[e("td",null,[e("code",null,"LEVELS")]),e("td"),e("td",null,"Give each user a rating label based on the number of comments")],-1),Q=d(`<h3 id="markdown" tabindex="-1"><a class="header-anchor" href="#markdown" aria-hidden="true">#</a> Markdown</h3><table><thead><tr><th>Environment Variables</th><th>Description</th></tr></thead><tbody><tr><td><code>MARKDOWN_CONFIG</code></td><td>MarkdownIt Config</td></tr><tr><td><code>MARKDOWN_HIGHLIGHT</code></td><td>Whether enable highlight, enable by default</td></tr><tr><td><code>MARKDOWN_EMOJI</code></td><td>Whether enable emoji, enable by default</td></tr><tr><td><code>MARKDOWN_SUB</code></td><td>Whether enable subscript, enable by default</td></tr><tr><td><code>MARKDOWN_SUP</code></td><td>Whether enable superscript, enable by default</td></tr><tr><td><code>MARKDOWN_TEX</code></td><td>Service to parse math, <code>&#39;mathjax&#39;</code> by default (also can be <code>false</code> | <code>&#39;katex&#39;</code>)</td></tr><tr><td><code>MARKDOWN_MATHJAX</code></td><td>MathJax Options</td></tr><tr><td><code>MARKDOWN_KATEX</code></td><td>Katex Options</td></tr></tbody></table><h3 id="level-label" tabindex="-1"><a class="header-anchor" href="#level-label" aria-hidden="true">#</a> Level Label</h3><p>According to the set rating conditions and the number of user comments, a level label will be added to the commenter. This feature is disabled by default and can be enabled by configuring the environment variable <code>LEVELS</code>. The configuration is in the form of a comma concatenation of a given number, for example <code>0,10,20,50,100,200</code> means:</p><table><thead><tr><th>Grades</th><th>Conditions</th><th>Default Grade Labels</th></tr></thead><tbody><tr><td>0</td><td>0 &lt;= count &lt; 10</td><td>Dwarves</td></tr><tr><td>1</td><td>10 &lt;= count &lt; 20</td><td>Hobbits</td></tr><tr><td>2</td><td>20 &lt;= count &lt; 50</td><td>Ents</td></tr><tr><td>3</td><td>50 &lt;= count &lt; 100</td><td>Wizards</td></tr><tr><td>4</td><td>100 &lt;= count &lt; 200</td><td>Elves</td></tr><tr><td>5</td><td>200 &lt;= count</td><td>Maiar</td></tr></tbody></table><p>In addition to customizing the level judgment rules, we can also customize the level label. Configure the text in the client as follows:</p><div class="language-javascript ext-js"><pre class="language-javascript"><code>new Waline({
  locale: {
    level0: &#39;Dwarves&#39;,
    level1: &#39;Hobbits&#39;,
    level2: &#39;Ents&#39;,
    level3: &#39;Wizards&#39;,
    level4: &#39;Elves&#39;,
    level5: &#39;Maiar&#39;,
  },
});
</code></pre></div><p>By default, only 6 levels of copywriting are provided, but it does not mean that there can only be 6 levels. The specific level cap is based on the level judgment rules you set. To add a new level, it is recommended to configure the label text corresponding to the level by yourself. If no label text is provided, the default label text such as <code>Level 10</code> will be displayed by default.</p><h3 id="database" tabindex="-1"><a class="header-anchor" href="#database" aria-hidden="true">#</a> Database</h3>`,9),q=d("<li><p><strong>MongoDB</strong>:</p><table><thead><tr><th>Environment Variable</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>MONGO_HOST</code></td><td></td><td>127.0.0.1</td><td>MongoDB server address, support array format</td></tr><tr><td><code>MONGO_PORT</code></td><td></td><td>27017</td><td>MongoDB server port, support array format</td></tr><tr><td><code>MONGO_DB</code></td><td>\u2705</td><td></td><td>MongoDB database name</td></tr><tr><td><code>MONGO_USER</code></td><td>\u2705</td><td></td><td>MongoDB server username</td></tr><tr><td><code>MONGO_PASSWORD</code></td><td>\u2705</td><td></td><td>MongoDB server password</td></tr><tr><td><code>MONGO_REPLICASET</code></td><td></td><td></td><td>MongoDB replica set</td></tr><tr><td><code>MONGO_AUTHSOURCE</code></td><td></td><td></td><td>MongoDB auth source</td></tr><tr><td><code>MONGO_OPT_SSL</code></td><td></td><td></td><td>use SSL connection</td></tr></tbody></table></li><li><p><strong>MySQL</strong>:</p><table><thead><tr><th>Environment Variable</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>MYSQL_HOST</code></td><td></td><td>127.0.0.1</td><td>MySQL server address</td></tr><tr><td><code>MYSQL_PORT</code></td><td></td><td>3306</td><td>MySQL server port</td></tr><tr><td><code>MYSQL_DB</code></td><td>\u2705</td><td></td><td>MySQL database name</td></tr><tr><td><code>MYSQL_USER</code></td><td>\u2705</td><td></td><td>MySQL server username</td></tr><tr><td><code>MYSQL_PASSWORD</code></td><td>\u2705</td><td></td><td>MySQL server password</td></tr><tr><td><code>MYSQL_PREFIX</code></td><td></td><td><code>wl_</code></td><td>MySQL table prefix</td></tr><tr><td><code>MYSQL_CHARSET</code></td><td></td><td><code>utf8mb4</code></td><td>MySQL table charset</td></tr></tbody></table></li><li><p><strong>SQLite</strong>:</p><table><thead><tr><th>Environment Variable</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>SQLITE_PATH</code></td><td>\u2705</td><td></td><td>SQLite storage file path, not include file name</td></tr><tr><td><code>SQLITE_DB</code></td><td></td><td>waline</td><td>SQLite storage file name, change it if your filenamed is not waline</td></tr><tr><td><code>SQLITE_PREFIX</code></td><td></td><td><code>wl_</code></td><td>SQLite table prefix</td></tr><tr><td><code>JWT_TOKEN</code></td><td>\u2705</td><td></td><td>Random String for login token generator</td></tr></tbody></table></li><li><p><strong>PostgreSQL</strong>:</p><table><thead><tr><th>Environment Variable</th><th>Required</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>PG_HOST</code></td><td></td><td>127.0.0.1</td><td>PostgreSQL server address</td></tr><tr><td><code>PG_PORT</code></td><td></td><td>3211</td><td>PostgreSQL server port</td></tr><tr><td><code>PG_DB</code></td><td>\u2705</td><td></td><td>PostgreSQL database name</td></tr><tr><td><code>PG_USER</code></td><td>\u2705</td><td></td><td>PostgreSQL server username</td></tr><tr><td><code>PG_PASSWORD</code></td><td>\u2705</td><td></td><td>PostgreSQL server password</td></tr><tr><td><code>PG_PREFIX</code></td><td></td><td><code>wl_</code></td><td>PostgreSQL table prefix</td></tr></tbody></table></li>",4),G=e("p",null,[e("strong",null,"GitHub"),t(":")],-1),B=e("thead",null,[e("tr",null,[e("th",null,"Environment Variable"),e("th",null,"Required"),e("th",null,"Default"),e("th",null,"Description")])],-1),C=e("td",null,"GITHUB_TOKEN",-1),U=e("td",null,"\u2705",-1),H=e("td",null,null,-1),K={href:"https://github.com/settings/tokens",target:"_blank",rel:"noopener noreferrer"},V=t("Personal access tokens"),Y=e("tr",null,[e("td",null,"GITHUB_REPO"),e("td",null,"\u2705"),e("td"),e("td",null,[t("repository name, such as "),e("code",null,"walinejs/waline")])],-1),z=e("tr",null,[e("td",null,"GITHUB_PATH"),e("td"),e("td"),e("td",null,[t("The data storage directory, such as "),e("code",null,"data"),t(" means it is stored in the "),e("code",null,"data"),t(" directory, root directory by default")])],-1),F=d(`<h2 id="main-entrance" tabindex="-1"><a class="header-anchor" href="#main-entrance" aria-hidden="true">#</a> Main entrance</h2><p>The following options need to be configured in the server entry file <code>index.js</code>.</p><div class="custom-container warning"><p class="custom-container-title">Note</p><p>If you are using template, please note that you need to save these configurations yourself, because they will be overwritten when you pull the latest official template.</p></div><h3 id="securedomains" tabindex="-1"><a class="header-anchor" href="#securedomains" aria-hidden="true">#</a> secureDomains</h3><ul><li>Type: <code>string | RegExp | string[] | RegExp[]</code></li></ul><p>Secure domain settings. Requests from other domain will receive 403 status code. It supports String, Regexp, and Array type. Leaving this config means that all domain referrer are allowed.</p><details class="custom-block details"><summary>Example</summary><div class="language-javascript ext-js"><pre class="language-javascript"><code>// index.js
const Waline = require(&#39;@waline/vercel&#39;);

module.exports = Waline({
  secureDomains: &#39;waline.js.org&#39;,
});
</code></pre></div></details><div class="custom-container tip"><p class="custom-container-title">Tips</p><ul><li>To make local development easier, <code>localhost</code> and <code>127.0.0.1</code> will be added to the list of secure domain names by default.</li><li>Env variable <code>SECURE_DOMAINS</code> won&#39;t work when this option is set.</li></ul></div><h3 id="forbiddenwords" tabindex="-1"><a class="header-anchor" href="#forbiddenwords" aria-hidden="true">#</a> forbiddenWords</h3><ul><li>Type: <code>string[]</code></li></ul><p>If a comment match forbidden word, it will be marked as spam.</p><details class="custom-block details"><summary>Example</summary><div class="language-javascript ext-js"><pre class="language-javascript"><code>// index.js
const Waline = require(&#39;@waline/vercel&#39;);

module.exports = Waline({
  forbiddenWords: [&#39;Trump&#39;],
});
</code></pre></div></details><h3 id="disallowiplist" tabindex="-1"><a class="header-anchor" href="#disallowiplist" aria-hidden="true">#</a> disallowIPList</h3><ul><li>Type: <code>string[]</code></li></ul><p>If a comment ip match this list, 403 status code is returned.</p><details class="custom-block details"><summary>Example</summary><div class="language-javascript ext-js"><pre class="language-javascript"><code>// index.js
const Waline = require(&#39;@waline/vercel&#39;);

module.exports = Waline({
  disallowIPList: [&#39;8.8.8.8&#39;, &#39;4.4.4.4&#39;],
});
</code></pre></div></details><h3 id="mailsubject" tabindex="-1"><a class="header-anchor" href="#mailsubject" aria-hidden="true">#</a> mailSubject</h3><ul><li>Type: <code>string</code></li></ul><p>Customize the title of the comment reply email, which is equivalent to environment variable <code>MAIL_SUBJECT</code>.</p><h3 id="mailtemplate" tabindex="-1"><a class="header-anchor" href="#mailtemplate" aria-hidden="true">#</a> mailTemplate</h3><ul><li>Type: <code>string</code></li></ul><p>Customize the content of the comment reply email, which is equivalent to environment variable <code>MAIL_TEMPLATE</code>.</p><h3 id="mailsubjectadmin" tabindex="-1"><a class="header-anchor" href="#mailsubjectadmin" aria-hidden="true">#</a> mailSubjectAdmin</h3><ul><li>Type: <code>string</code></li></ul><p>Customize the title of the new comment notification email, which is equivalent to the environment variable <code>MAIL_SUBJECT_ADMIN</code>.</p><h3 id="mailtemplateadmin" tabindex="-1"><a class="header-anchor" href="#mailtemplateadmin" aria-hidden="true">#</a> mailTemplateAdmin</h3><ul><li>Type: <code>string</code></li></ul><p>Customize the content of the new comment notification email, which is equivalent to the environment variable <code>MAIL_TEMPLATE_ADMIN</code>.</p><h3 id="qqtemplate" tabindex="-1"><a class="header-anchor" href="#qqtemplate" aria-hidden="true">#</a> QQTemplate</h3><ul><li>Type: <code>string</code></li></ul><p>The QQ comment notification template, which is equivalent to the environment variable <code>QQ_TEMPLATE</code>.</p><h3 id="tgtempalte" tabindex="-1"><a class="header-anchor" href="#tgtempalte" aria-hidden="true">#</a> TGTempalte</h3><ul><li>Type: <code>string</code></li></ul><p>Telegram comment notification template, which is equivalent to the environment variable <code>TG_TEMPLATE</code>.</p><h2 id="comment-hooks" tabindex="-1"><a class="header-anchor" href="#comment-hooks" aria-hidden="true">#</a> Comment Hooks</h2><p>Besides environment variable configuration, Waline also provides some custom hooks to facilitate the processing of custom requirements. It only needs to be configured in the server entry file <code>index.js</code>.</p><h3 id="presave-comment" tabindex="-1"><a class="header-anchor" href="#presave-comment" aria-hidden="true">#</a> preSave(comment)</h3><p>Waline provides some custom hooks to let users customize Waline server behavior according to their own needs.</p><details class="custom-block details"><summary>Example</summary><div class="language-javascript ext-js"><pre class="language-javascript"><code>// index.js
const Waline = require(&#39;@waline/vercel&#39;);

module.exports = Waline({
  async preSave(comment) {
    const isSapm = await Akismet.check(comment);
    if (isSpam) {
      return { errmsg: &quot;It&#39;s a spam!&quot; };
    }
  },
});
</code></pre></div></details><h3 id="postsave-comment-pcomment" tabindex="-1"><a class="header-anchor" href="#postsave-comment-pcomment" aria-hidden="true">#</a> postSave(comment, pComment)</h3><p>The action performed after the comment is posted.</p><p>When the method is executed, the comment data will be passed as the first param, and if it&#39;s a reply to the comment, the parent comment will be passed as the second param.</p><details class="custom-block details"><summary>Example</summary><div class="language-javascript ext-js"><pre class="language-javascript"><code>// index.js
const Waline = require(&#39;@waline/vercel&#39;);

module.exports = Waline({
  async postSave(comment, pComment) {
    await mailto({
      mail: pComment.mail,
      text: \`\${comment.nick} replied your comment!\`,
    });
  },
});
</code></pre></div></details><h3 id="preupdate-comment" tabindex="-1"><a class="header-anchor" href="#preupdate-comment" aria-hidden="true">#</a> preUpdate(comment)</h3><p>Action before a comment content is updated in the dashboard. If the method returns content, the interface will return directly without updating the comment data.</p><details class="custom-block details"><summary>Example</summary><div class="language-javascript ext-js"><pre class="language-javascript"><code>// index.js
const Waline = require(&#39;@waline/vercel&#39;);

module.exports = Waline({
  async preUpdate(comment) {
    return &quot;Then you can&#39;t update comment data&quot;;
  },
});
</code></pre></div></details><h3 id="afterupdate-comment" tabindex="-1"><a class="header-anchor" href="#afterupdate-comment" aria-hidden="true">#</a> afterUpdate(comment)</h3><p>Action after a comment content is updated in the dashboard. Comment data will be passed in when the method is executed.</p><details class="custom-block details"><summary>Example</summary><div class="language-javascript ext-js"><pre class="language-javascript"><code>// index.js
const Waline = require(&#39;@waline/vercel&#39;);

module.exports = Waline({
  async postUpdate(comment) {
    console.log(\`comment \${comment.objectId} has been updated!\`);
  },
});
</code></pre></div></details><h3 id="predelete-commentid" tabindex="-1"><a class="header-anchor" href="#predelete-commentid" aria-hidden="true">#</a> preDelete(commentId)</h3><p>Action before a comment is deleted. When the method is executed, the comment Id to be operated will be passed in. If the method returns content, the interface will return directly without updating the comment data.</p><details class="custom-block details"><summary>Example</summary><div class="language-javascript ext-js"><pre class="language-javascript"><code>// index.js
const Waline = require(&#39;@waline/vercel&#39;);

module.exports = Waline({
  async preDelete(commentId) {
    return &quot;Then you can&#39;t delete comment&quot;;
  },
});
</code></pre></div></details><h3 id="afterdelete-commentid" tabindex="-1"><a class="header-anchor" href="#afterdelete-commentid" aria-hidden="true">#</a> afterDelete(commentId)</h3><p>Action after a comment is deleted, the comment Id will be passed as the only param.</p><details class="custom-block details"><summary>Example</summary><div class="language-javascript ext-js"><pre class="language-javascript"><code>// index.js
const Waline = require(&#39;@waline/vercel&#39;);

module.exports = Waline({
  async postDelete(commentId) {
    console.log(\`comment \${commentId} has been deleted!\`);
  },
});
</code></pre></div></details>`,55);function X(J,$){const a=l("ExternalLinkIcon");return r(),i(s,null,[u,e("table",null,[h,e("tbody",null,[m,p,b,v,_,f,g,y,w,x,E,S,T,L,A,e("tr",null,[M,D,e("td",null,[I,j,O,e("a",R,[W,n(a)]),k])]),N,P])]),Q,e("ul",null,[q,e("li",null,[G,e("table",null,[B,e("tbody",null,[e("tr",null,[C,U,H,e("td",null,[e("a",K,[V,n(a)])])]),Y,z])])])]),F],64)}var te=o(c,[["render",X],["__file","server.html.vue"]]);export{te as default};
